<html>
<head>
  <meta charset='utf-8'/>
  <script src = '../dist/plotly.js'></script>
</head>

<body>
  <h2>select in left plot to filter right plot</h2>
  <div id='plotly1' style='display:block;float:left;width:50%'></div>
  <div id='plotly2' style='display:block;float:left;width:50%'></div>
  <script>
    var d3 = Plotly.d3;
    
    var data = [{
      x: [20, 11, 12, 0, 1, 2, 3],
      y: [1, 2, 3, 2, 5, 2, 0],
      type: 'scatter',
      mode: 'markers'
    }];
    
    var data2 = JSON.parse(JSON.stringify(data));
    
    Plotly.plot('plotly1', data)
      .then(function(gd){
        gd.on('plotly_selected', function(sel){
          var data_trans = JSON.parse(JSON.stringify(data));
          if(sel){
            data_trans[0].transforms = [{
              type:'filter',
              operation:'in',
              value:sel.points.map(function(d){return d.x}),
              filtersrc:'x'
            }];
            data_trans[0].transforms.push({
              type:'filter',
              operation:'in',
              value:sel.points.map(function(d){return d.y}),
              filtersrc:'y'
            })
          }
          
          gd2 = document.getElementById('plotly2');
          
          /*  animate would be perfect here but getting error
          var frame = {
              "name": "frame" + gd2._frameData._frames.length,
              "data": data_trans,
              "baseFrame": "base",
              "traceIndices": [0],
              "layout": { }
          };
          
          Plotly.addFrames(gd2, [frame]).then(
            function(gd2){
              return Plotly.animate(gd2, "frame" + gd2._frameData._frames.length)  
            }
          );
          
          */
          
          Plotly.newPlot(gd2, data_trans);
        });
      });
      
    Plotly.plot('plotly2', data)
      .then(function(gd){
        return Plotly.addFrames(gd,[{
          'name': 'base',
          'data': data
        }]);
      });

  </script>
</body>
</html>
